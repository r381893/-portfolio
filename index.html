<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å°ˆæ¡ˆé›† | Portfolio</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
    <link rel="stylesheet" href="styles.css?v=6.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸš€ æˆ‘çš„å°ˆæ¡ˆé›†</h1>
            <p class="subtitle">äº¤æ˜“åˆ†æèˆ‡æŠ•è³‡å·¥å…·</p>
            <button class="admin-toggle-btn" id="adminToggle">âš™ï¸ ç®¡ç†</button>
        </header>

        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
            <button class="filter-btn" data-filter="pwa">PWA</button>
            <button class="filter-btn" data-filter="streamlit">Streamlit</button>
            <button class="filter-btn" data-filter="local">æœ¬æ©Ÿ</button>
            <button class="filter-btn" data-filter="cloud">é›²ç«¯</button>
        </div>

        <main class="projects-grid" id="projects-container">
            <div class="loading">è¼‰å…¥ä¸­...</div>
        </main>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div class="admin-header">
                <h2>ğŸ“ å°ˆæ¡ˆç®¡ç†</h2>
                <button class="close-btn" id="closeAdmin">âœ•</button>
            </div>

            <form id="projectForm" class="project-form">
                <input type="hidden" id="projectId">

                <div class="form-group">
                    <label>å°ˆæ¡ˆåç¨±</label>
                    <input type="text" id="projectName" required placeholder="ä¾‹å¦‚ï¼š00631L é¿éšªç³»çµ±">
                </div>

                <div class="form-group">
                    <label>æè¿°</label>
                    <input type="text" id="projectDesc" required placeholder="ç°¡çŸ­æè¿°å°ˆæ¡ˆåŠŸèƒ½">
                </div>

                <div class="form-group">
                    <label>é è¦½åœ–ç‰‡ç¶²å€ (é¸å¡«)</label>
                    <input type="url" id="projectImage" placeholder="https://... (åœ–ç‰‡å°‡å–ä»£åœ–ç¤ºé¡¯ç¤º)">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>åœ–ç¤º (è‹¥ç„¡åœ–ç‰‡å‰‡é¡¯ç¤º)</label>
                        <select id="projectIcon">
                            <option value="fa-solid fa-chart-line">ğŸ“ˆ è¶¨å‹¢åœ–</option>
                            <option value="fa-solid fa-chart-pie">ğŸ¥§ åœ“é¤…åœ–</option>
                            <option value="fa-solid fa-coins">ğŸ’° ç¡¬å¹£/è³‡ç”¢</option>
                            <option value="fa-solid fa-rocket">ğŸš€ ç«ç®­/åŠ é€Ÿ</option>
                            <option value="fa-solid fa-robot">ğŸ¤– æ©Ÿå™¨äºº/è‡ªå‹•åŒ–</option>
                            <option value="fa-solid fa-scale-balanced">âš–ï¸ å¹³è¡¡/äº¤æ˜“</option>
                            <option value="fa-solid fa-fire">ğŸ”¥ ç†±é–€/å‹•ç«</option>
                            <option value="fa-solid fa-file-invoice">ğŸ“„ è¡¨å–®/æ–‡ä»¶</option>
                            <option value="fa-solid fa-book">ğŸ“– æ›¸æœ¬/çŸ¥è­˜</option>
                            <option value="fa-solid fa-download">ğŸ“¥ ä¸‹è¼‰å·¥å…·</option>
                            <option value="fa-solid fa-server">ğŸ–¥ï¸ ä¼ºæœå™¨/æœ¬æ©Ÿ</option>
                            <option value="fa-brands fa-python">ğŸ Python</option>
                            <option value="fa-solid fa-laptop-code">ğŸ’» ç¨‹å¼é–‹ç™¼</option>
                            <option value="fa-solid fa-magnifying-glass-chart">ğŸ” åˆ†æå·¥å…·</option>
                            <option value="fa-solid fa-layer-group">ğŸ“š å°ˆæ¡ˆé›†</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>é¡å‹</label>
                        <select id="projectType">
                            <option value="pwa">PWA</option>
                            <option value="streamlit">Streamlit</option>
                            <option value="local">æœ¬æ©Ÿ (Python)</option>
                            <option value="cloud">é›²ç«¯ (Railway)</option>
                            <option value="future">å³å°‡æ¨å‡º</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>ç¶²å€</label>
                    <input type="url" id="projectUrl" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label>GitHub Repo</label>
                    <input type="url" id="projectRepo" placeholder="https://github.com/...">
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ å„²å­˜</button>
                    <button type="button" class="btn btn-secondary" id="clearForm">æ¸…é™¤</button>
                </div>
            </form>
            <div class="admin-list" id="adminList">
                <!-- Project list for editing -->
            </div>
        </div>

        <footer>
            <p>Â© 2024 - æŒçºŒæ›´æ–°ä¸­</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script src="firebase-config.js"></script>
    <script>
        /**
         * Portfolio ä¸»ç¨‹å¼ - Firebase ç‰ˆæœ¬
         */

        // é è¨­å°ˆæ¡ˆè³‡æ–™ï¼ˆé¦–æ¬¡ä½¿ç”¨æ™‚åŒ¯å…¥ï¼‰
        const defaultProjects = []; // ç°¡åŒ–é è¨­å€¼ï¼Œå› ç‚ºä¸»è¦ä¾è³´ Firebase

        let projects = [];
        let currentFilter = 'all';
        let isAdminOpen = false;
        let editingId = null;

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('projects-container');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const adminToggle = document.getElementById('adminToggle');
            const adminPanel = document.getElementById('adminPanel');
            const closeAdmin = document.getElementById('closeAdmin');
            const projectForm = document.getElementById('projectForm');
            const clearFormBtn = document.getElementById('clearForm');

            // ç›£è½ Firebase è³‡æ–™è®ŠåŒ–
            projectsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    projects = Object.entries(data).map(([id, project]) => ({
                        id,
                        ...project
                    })).sort((a, b) => (a.order || 999) - (b.order || 999));
                }
                renderProjects();
                renderAdminList();
            });

            // æ¸²æŸ“å°ˆæ¡ˆå¡ç‰‡
            function renderProjects() {
                container.innerHTML = '';

                const filteredProjects = currentFilter === 'all'
                    ? projects
                    : projects.filter(p => p.type === currentFilter);

                if (filteredProjects.length === 0) {
                    container.innerHTML = '<div class="loading">å°šç„¡å°ˆæ¡ˆ</div>';
                    return;
                }

                filteredProjects.forEach(project => {
                    const card = createProjectCard(project);
                    container.appendChild(card);
                });
            }

            // å»ºç«‹å°ˆæ¡ˆå¡ç‰‡
            function createProjectCard(project) {
                const card = document.createElement('div');
                const isPlaceholder = project.type === 'future' || !project.url;
                card.className = `project-card ${isPlaceholder ? 'placeholder' : ''}`;

                // å¾ Repo URL æå–è³‡æ–™å¤¾åç¨±
                let folderName = '';
                if (project.repo) {
                    const parts = project.repo.split('/');
                    folderName = parts[parts.length - 1];
                }

                // è™•ç†åœ–ç¤º vs åœ–ç‰‡
                let iconHtml = '';
                if (project.image) {
                    iconHtml = `<div class="card-image" style="background-image: url('${project.image}')"></div>`;
                    card.classList.add('has-image');
                } else {
                    const isFontAwesome = (project.icon || '').includes('fa-');
                    if (isFontAwesome) {
                        iconHtml = `<i class="card-icon-fa ${project.icon}"></i>`;
                    } else {
                        iconHtml = `<span class="card-icon">${project.icon || 'ğŸ“'}</span>`;
                    }
                }

                card.innerHTML = `
            <div class="card-header">
                ${iconHtml}
                <div class="card-title-group">
                    <h3 class="card-title">${project.name}</h3>
                    ${folderName ? `<span class="card-repo-name">ğŸ“‚ ${folderName}</span>` : ''}
                </div>
            </div>
            <p class="card-description">${project.description || ''}</p>
            <div class="card-footer">
                <div class="card-actions">
                    ${!isPlaceholder ? `
                    <button class="action-btn local" onclick="copyProjectPath('${folderName || project.name}'); event.stopPropagation();">
                        <i class="fa-solid fa-copy"></i> è¤‡è£½è·¯å¾‘
                    </button>
                    ` : ''}
                    
                    ${project.url && !project.url.includes('localhost') && !isPlaceholder ? `
                    <button class="action-btn cloud" onclick="window.open('${project.url}', '_blank'); event.stopPropagation();">
                        <i class="fa-solid fa-cloud"></i> é›²ç«¯
                    </button>
                    ` : ''}
                </div>

                ${project.repo && !isPlaceholder ? `
                    <a class="card-link" href="${project.repo}" target="_blank" onclick="event.stopPropagation()">
                        <i class="fa-brands fa-github"></i>
                    </a>
                ` : ''}
            </div>
        `;

                return card;
            }

            // è¤‡è£½è·¯å¾‘åŠŸèƒ½
            window.copyProjectPath = function (folderName) {
                // å˜—è©¦åµæ¸¬ç›®å‰ç¶²é çš„è·¯å¾‘
                // å¦‚æœæ˜¯ file:///D:/ç¶²è·¯ç‰ˆ/Portfolio-Main/index.html
                // æˆ‘å€‘è¦æŠ“çš„æ˜¯ D:\ç¶²è·¯ç‰ˆ\ + folderName

                let basePath = "";
                try {
                    // è§£ç¢¼ URL (è™•ç†ä¸­æ–‡è·¯å¾‘)
                    const pathname = decodeURIComponent(window.location.pathname);

                    // ç§»é™¤é–‹é ­çš„ / (Windows ä¸Š file:/// æœƒæœ‰ /D:/...)
                    let rawPath = pathname.startsWith('/') ? pathname.slice(1) : pathname;

                    // å–å¾—ä¸Šä¸€å±¤ç›®éŒ„ (å›åˆ° "ç¶²è·¯ç‰ˆ" å±¤ç´š)
                    // ç›®å‰åœ¨ Portfolio-Mainï¼Œæ‰€ä»¥è¦å¾€ä¸Šå…©å±¤æ‰¾åˆ°æ ¹ï¼Œæˆ–è€…å¾€ä¸Šä¸€å±¤æ‰¾åˆ°åŒç´šè³‡æ–™å¤¾
                    // å‡è¨­çµæ§‹: D:\ç¶²è·¯ç‰ˆ\Portfolio-Main\index.html
                    // ç›®æ¨™: D:\ç¶²è·¯ç‰ˆ\ç›®æ¨™è³‡æ–™å¤¾

                    const pathParts = rawPath.split('/');
                    // ç§»é™¤ index.html
                    pathParts.pop();
                    // ç§»é™¤ Portfolio-Main (å¾€ä¸Šä¸€å±¤)
                    pathParts.pop();

                    // é‡çµ„è·¯å¾‘ (ç”¨åæ–œç·šçµ¦ Windows)
                    basePath = pathParts.join('\\');
                } catch (e) {
                    basePath = "D:\\ç¶²è·¯ç‰ˆ"; // Fallback
                }

                const fullPath = `${basePath}\\${folderName}`;

                // å˜—è©¦åœ¨ç€è¦½å™¨é–‹å•Ÿè©²è³‡æ–™å¤¾ (é¡¯ç¤ºæª”æ¡ˆåˆ—è¡¨)
                try {
                    const pathForBrowser = 'file:///' + fullPath.replace(/\\/g, '/');
                    window.open(pathForBrowser, '_blank');
                } catch (e) {
                    console.error("Browser blocked opening file URL");
                }

                // åŸ·è¡Œè¤‡è£½ (ä½œç‚ºå‚™ç”¨)
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(fullPath).then(() => {
                        // é€™è£¡ä¸è·³ Alert å¹²æ“¾äº†ï¼Œæ”¹æˆ console log æˆ–å®‰éœå¤±æ•—
                        console.log("Path copied");
                    }).catch(() => { });
                }
            };

            // æ¸²æŸ“ç®¡ç†åˆ—è¡¨
            function renderAdminList() {
                const adminList = document.getElementById('adminList');
                adminList.innerHTML = '<h3>ç¾æœ‰å°ˆæ¡ˆ</h3>';

                projects.forEach(project => {
                    const item = document.createElement('div');
                    item.className = 'admin-item';

                    // åˆ—è¡¨åœ–ç¤ºè™•ç†
                    let listIcon = '';
                    if (project.icon && project.icon.includes('fa-')) {
                        listIcon = `<i class="${project.icon}"></i>`;
                    } else {
                        listIcon = project.icon || 'ğŸ“';
                    }

                    item.innerHTML = `
                <span class="admin-item-icon">${listIcon}</span>
                <span class="admin-item-name">${project.name}</span>
                <div class="admin-item-actions">
                    <button class="btn-edit" onclick="editProject('${project.id}')">âœï¸</button>
                    <button class="btn-delete" onclick="deleteProject('${project.id}')">ğŸ—‘ï¸</button>
                </div>
            `;
                    adminList.appendChild(item);
                });
            }

            // ç¯©é¸æŒ‰éˆ•
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderProjects();
                });
            });

            // ç®¡ç†é¢æ¿é–‹é—œ
            adminToggle.addEventListener('click', () => {
                isAdminOpen = !isAdminOpen;
                adminPanel.classList.toggle('open', isAdminOpen);
            });

            closeAdmin.addEventListener('click', () => {
                isAdminOpen = false;
                adminPanel.classList.remove('open');
            });

            // è¡¨å–®æäº¤
            projectForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const projectData = {
                    name: document.getElementById('projectName').value,
                    description: document.getElementById('projectDesc').value,
                    image: document.getElementById('projectImage').value, // æ–°å¢æ¬„ä½
                    icon: document.getElementById('projectIcon').value || 'fa-solid fa-folder',
                    type: document.getElementById('projectType').value,
                    url: document.getElementById('projectUrl').value,
                    repo: document.getElementById('projectRepo').value,
                    order: editingId ? projects.find(p => p.id === editingId)?.order : projects.length + 1
                };

                if (editingId) {
                    projectsRef.child(editingId).update(projectData);
                } else {
                    projectsRef.push(projectData);
                }

                clearForm();
            });

            // æ¸…é™¤è¡¨å–®
            clearFormBtn.addEventListener('click', clearForm);

            function clearForm() {
                projectForm.reset();
                editingId = null;
                document.getElementById('projectId').value = '';
            }

            // å…¨åŸŸå‡½æ•¸
            window.editProject = function (id) {
                const project = projects.find(p => p.id === id);
                if (!project) return;

                editingId = id;
                document.getElementById('projectId').value = id;
                document.getElementById('projectName').value = project.name || '';
                document.getElementById('projectDesc').value = project.description || '';
                document.getElementById('projectImage').value = project.image || ''; // æ–°å¢æ¬„ä½
                document.getElementById('projectIcon').value = project.icon || '';
                document.getElementById('projectType').value = project.type || 'pwa';
                document.getElementById('projectUrl').value = project.url || '';
                document.getElementById('projectRepo').value = project.repo || '';

                // æ»¾å‹•åˆ°è¡¨å–®
                document.getElementById('projectForm').scrollIntoView({ behavior: 'smooth' });
            };

            window.deleteProject = function (id) {
                if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å°ˆæ¡ˆå—ï¼Ÿ')) {
                    projectsRef.child(id).remove();
                }
            };
        });
    </script>
</body>

</html>